<?xml version="1.0" encoding="UTF-8"?>
<project basedir=".">
	<target name="install_dependencies">
        <!--<if>
            <istrue property="INSTALL_SOFTWARE_FROM_SCRIPT"/>
            <then>-->
                <exec executable="cmd" dir="${PROTRACTOR.DIR}" osfamily="windows" failonerror="true">
			        <arg line="/c npm install --production" />
		        </exec>
                <exec executable="bash" dir="${PROTRACTOR.DIR}" osfamily="unix" failonerror="true">
                    <arg value="-c" />
                    <arg value="npm install --production"/>
                </exec>
            <!--</then>
            <else>
                <echo level="info" message="Install of software disabled from config, will use manual install of E2E Dependencies" />
            </else>
        </if>-->
	</target>

	<target name="run_e2e_tests" depends="install_dependencies">
		    <echo level="verbose" message="Run tests script started"/>
			<echo level="verbose" message="Testing solution: ${SERVOY.SOLUTION}"/>

		<exec executable="node" resultproperty="e2e.failed">
            <arg value="${PROTRACTOR.DIR}/node_modules/protractor/bin/protractor" />
			<arg value="${PROTRACTOR.CONF}"/>
		</exec>
	</target>

    <macrodef name="fail-if-e2e-failed">
        <sequential>
            <fail message="E2E failed: please check reports." if="e2e.failed" />
        </sequential>
    </macrodef>
</project>
