<?xml version="1.0" encoding="UTF-8"?>
<project basedir=".">
    <target name="install_dependencies">
        <if>
            <istrue value="${INSTALL_SOFTWARE_FROM_SCRIPT}"/>
            <then>
                <exec executable="${OS.COMMAND.EXECUTER}" dir="${TOOLS-DIR}"  failonerror="true">
                    <arg value="${OS.COMMAND.CALL} npm install --production"/>
                </exec>
            </then>
            <else>
                <echo level="info" message="Install of software disabled from config, will use manual install of E2E Dependencies" />
            </else>
        </if>
    </target>

    <target name="run_e2e_tests" depends="install_dependencies">
            <echo level="verbose" message="Run tests script started"/>
            <echo level="verbose" message="Testing solution: ${SERVOY.SOLUTION}"/>

    <!-- TODO: Add fail handler for PROTRACTOR -->
    <echo>
        ${OS.COMMAND.EXECUTER} ${OS.COMMAND.CALL} protractor ${PROTRACTOR.CONF} --seleniumAddress=${PROTRACTOR.SELENIUM.URL} --params.testDomainURL=${PROTRACTOR.TEST.URL}
    </echo>
        <exec executable="${OS.COMMAND.EXECUTER}">
            <arg value="${OS.COMMAND.CALL} protractor" />
            <arg value="${PROTRACTOR.CONF}"/>
            <arg value="--seleniumAddress=${PROTRACTOR.SELENIUM.URL}" />
            <arg value="--params.testDomainURL=${PROTRACTOR.TEST.URL}"/>
        </exec>
    </target>

    <macrodef name="fail-if-e2e-failed">
        <sequential>
            <fail message="E2E failed: please check reports." if="${E2E.FAILED}" />
        </sequential>
    </macrodef>
</project>
